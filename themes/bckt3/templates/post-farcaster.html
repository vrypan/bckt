{% extends "base.html" %}

{% block page_title %}
{{ config.title | default("bckt") }}
{% endblock page_title %}

{% block page_meta %}
{% set canonical = (config.base_url | default("")) ~ post.permalink %}
<meta name="description" content="{{ post.excerpt }}">
<meta property="og:site_name" content="{{ config.title | default("bckt") }}">
<meta property="og:type" content="article">
<meta property="og:title" content="{{ config.title | default("bckt") }}">
<meta property="og:url" content="{{ canonical }}">
<meta property="og:description" content="{{ post.excerpt }}">
<link rel="canonical" href="{{ canonical }}">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="{{ config.title | default("bckt") }}">
<meta name="twitter:description" content="{{ post.excerpt }}">
{% endblock page_meta %}

{% block content %}
<article class="post-article post-article--farcaster">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="{{ post.date_iso }}">{{ post.date }}</time>
      {% if post.tags %}
        <span class="meta-divider">â€¢</span>
        <ul class="post-tags">
          {% for tag in post.tags %}
          <li><a href="/tags/{{ tag | replace(' ', '-') | lower }}/">#{{ tag }}</a></li>
          {% endfor %}
        </ul>
      {% endif %}
    </div>
  </header>
  <div class="post-content reading-flow">
    {{ post.body | safe }}
  </div>
  {% set images = post.images | default([]) %}
  {% if images %}
  <div class="post-media post-media--images">
    {% for image in images %}
      {% if image is string %}
        {% set src = image %}
        {% if not src.startswith('http://') and not src.startswith('https://') and not src.startswith('/') %}
          {% set src = post.permalink ~ src %}
        {% endif %}
        <figure class="post-media__item">
          <img src="{{ src }}" alt="">
        </figure>
      {% elif image.url is defined %}
        {% set src = image.url %}
        {% if not src.startswith('http://') and not src.startswith('https://') and not src.startswith('/') %}
          {% set src = post.permalink ~ src %}
        {% endif %}
        <figure class="post-media__item">
          <img src="{{ src }}" alt="{{ image.alt | default("") }}">
        </figure>
      {% endif %}
    {% endfor %}
  </div>
  {% endif %}
  {% set videos = post.videos | default([]) %}
  {% if videos %}
  <div class="post-media post-media--videos">
    {% for video in videos %}
      {% if video is string %}
        {% set src = video %}
        {% if not src.startswith('http://') and not src.startswith('https://') and not src.startswith('/') %}
          {% set src = post.permalink ~ src %}
        {% endif %}
        <div class="post-media__video">
          <video controls preload="metadata" src="{{ src }}"></video>
        </div>
      {% elif video.url is defined %}
        {% set src = video.url %}
        {% if not src.startswith('http://') and not src.startswith('https://') and not src.startswith('/') %}
          {% set src = post.permalink ~ src %}
        {% endif %}
        <div class="post-media__video">
          <video controls preload="metadata" src="{{ src }}"></video>
        </div>
      {% endif %}
    {% endfor %}
  </div>
  {% endif %}
</article>
{% endblock content %}
